# Section 9 of 18: Database Schema (v3)

This section provides the SQL schema for the tables in our Supabase Postgres database, now including custom `ENUM` types for data integrity.

```sql
-- Create ENUM types first
CREATE TYPE instock_status AS ENUM ('yes', 'no', 'hide');
CREATE TYPE dietary_info AS ENUM ('veg', 'non-veg');
CREATE TYPE status_type AS ENUM ('image', 'video', 'text');

-- In the PRIMARY Supabase project
-- This table maps a vendor to their dedicated Supabase project and ImageKit account.
CREATE TABLE public.vendor_mappings (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  vendor_slug text NOT NULL UNIQUE,
  backend_type text NOT NULL, -- 'supabase' or 'gsheets'
  supabase_project_id text,
  gsheet_id text,
  imagekit_account_id text NOT NULL,
  membership_fee real DEFAULT 0,
  membership_validity date DEFAULT (now() + '10 days'::interval),
  is_member boolean DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- RLS (Row Level Security) needs to be created for this table. 
-- Vendors should only be able to see their own mapping.

-----------------------------------------------------------------

-- In EACH of the 4 VENDOR Supabase projects
-- Stores the vendor's brand profile information.
CREATE TABLE public.brand (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  vendor_id uuid NOT NULL REFERENCES auth.users(id),
  name text NOT NULL,
  logo_url text,
  cuisine text,
  description text,
  payment_link text,
  whatsapp text,
  contact text,
  location_link text,
  review_link text,
  instagram text,
  facebook text,
  youtube text,
  custom text,
  full_menu_pic text,
  created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- Stores the individual menu items for a vendor.
CREATE TABLE public.dishes (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  vendor_id uuid NOT NULL REFERENCES auth.users(id),
  category text NOT NULL,
  name text NOT NULL,
  description text,
  price real,
  instock instock_status DEFAULT 'yes', -- Use ENUM type
  veg dietary_info, -- Use ENUM type
  tag text,
  image text,
  reel text,
  created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- Stores daily status updates from the vendor.
CREATE TABLE public.status (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  vendor_id uuid NOT NULL REFERENCES auth.users(id),
  content text NOT NULL,
  type status_type NOT NULL, -- Use ENUM type
  created_at timestamp with time zone NOT NULL DEFAULT now()
);
```

---
