---
epic: 3
story: 3
title: "Instagram-style Status Feature (v2)"
status: "Draft"
---

### Story Statement

As a vendor, I want to be able to post temporary updates or promotions as "stories" that customers can view, similar to Instagram Stories.

### Acceptance Criteria

1.  The data fetching service fetches from the `status` tab on **every page load**.
2.  If the `status` tab has content, the vendor logo displays the gradient ring.
3.  Clicking the logo opens a full-screen story viewer.
4.  The viewer logic must validate each status item. Empty or whitespace-only entries are **ignored**.
5.  An item is identified as **Media** if it's a valid URL pointing to a cloudinary media file.
6.  Any item not identified as Media is treated as **Text**.
7.  **Edge Case (Broken Media):** If a media URL fails to load, the story viewer must gracefully skip to the next item after a 2-second timeout, not show a broken icon.
8.  **Edge Case (Long Text):** Text content should automatically scale down to fit the screen. Excessively long text is truncated with an ellipsis (...).
9.  Media is displayed for its duration (video) or 10s (image). Text is displayed for 10s on a gradient background.
10. The viewer auto-progresses and can be dismissed.

### Dev Notes

#### Technical Specifications

*   **Library:** This feature **must** use the `react-insta-stories` library for the viewer component. [Source: `docs/prd.md#Story-3.3`]
*   **Data Fetching:** The `getStatusData` function in the `gsheets.ts` service (from Story 1.2) will be called on every page load.
*   **UI:**
    *   The `BrandHeader` component (Story 1.3) will be modified to conditionally apply the gradient ring to the logo and handle the `onClick` event.
    *   A new `StatusViewer` component will be created to wrap the `react-insta-stories` library and handle the data mapping and validation logic.
*   **Logic:** The core logic involves mapping the raw data from the `status` sheet into the format expected by `react-insta-stories`, including differentiating between image/video and text content.

#### File Locations

*   This story will modify:
    *   `apps/client/src/services/gsheets.ts`
    *   `apps/client/src/components/shared/BrandHeader.tsx`
*   This story will create a new component:
    *   `apps/client/src/components/features/status/StatusViewer.tsx`

### Tasks / Subtasks

1.  **Dependency:** Add the `react-insta-stories` library to the project.
2.  **(AC: 1)** In the main page component, call the `getStatusData` service on page load.
3.  **(AC: 2)** In `BrandHeader.tsx`, accept a new prop, `hasStatus: boolean`. Use this to conditionally apply the CSS classes for the gradient ring around the logo.
4.  **(AC: 3)** Create the `StatusViewer.tsx` component. It will take the `status` data as a prop and be conditionally rendered (as a modal/overlay) when the user clicks the logo.
5.  **(AC: 4, 5, 6)** Inside `StatusViewer`, implement the logic to process the raw status data. Filter out empty entries. For each valid entry, create an object for the stories array, determining if it's an image, video, or text.
6.  **(AC: 7, 8, 9)** Configure the `react-insta-stories` component, setting the duration for different story types and handling potential media loading errors.
7.  **(AC: 10)** Ensure the viewer can be dismissed (e.g., with a close button or by the library's default behavior).
8.  **Test (Integration):** Write tests to verify:
    *   The gradient ring appears on the logo only when status data is present.
    *   Clicking the logo opens the `StatusViewer`.
    *   The data mapping logic correctly identifies media vs. text stories.
