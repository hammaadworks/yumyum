---
epic: 1
story: 5
title: "Controls Bar (v2 - Corrected)"
status: "Draft"
---

### Story Statement

As a user, I want to be able to filter and sort the menu, so I can find the dishes I am interested in more easily.

### Acceptance Criteria

1.  A `ControlsBar` component is created.
2.  The bar contains a "Veg Only" toggle switch. The state of this toggle is managed globally.
3.  The bar contains a "Sort by Price" control. It defaults to "low-to-high" and can be toggled to "high-to-low".
4.  The bar contains a Search input field. (The search logic itself will be deferred to a later story).

### Dev Notes

#### Technical Specifications

*   **UI Components:** This component will be composed of base components from `shadcn-ui`.
    *   `Switch` and `Label` for the "Veg Only" toggle.
    *   `Button` for the "Sort by Price" control.
    *   `Input` for the search field.
*   **Icons:** Use the `Search` icon from `lucide-react` inside the input field. [Source: `docs/ui_init.md`]
*   **State Management:** The state for the filters and sorting (e.g., `isVegOnly`, `sortOrder`) will be managed in a global Zustand store to allow other components like the `DishGrid` to react to changes. [Source: `docs/prd.md#Story-1.5`]

#### File Locations

*   **Component:** `apps/client/src/components/shared/controls-bar.tsx` [Source: `docs/ui_init.md`]
*   **State Store:** A new store, `use-filter.store.ts` (or similar), should be created in `apps/client/src/store/`. [Source: `docs/ui-architecture.md#Section-5`]

### Tasks / Subtasks

1.  **(AC: 1)** Create the `controls-bar.tsx` file.
2.  **(AC: 2, 3, 4)** Assemble the UI using Shadcn's `Switch`, `Label`, `Button`, and `Input` components.
3.  **State:** Create a new Zustand store to manage the state of the controls (e.g., `vegOnly: boolean`, `sortBy: 'asc' | 'desc'`).
4.  **(AC: 2)** Connect the `Switch` component to the Zustand store, so that toggling it updates the global `vegOnly` state.
5.  **(AC: 3)** Connect the `Button` to the Zustand store. Clicking it should toggle the `sortBy` state between `asc` and `desc`.
6.  **(AC: 4)** Add the `Search` icon to the `Input` component. The input's logic will be implemented in a future story.
7.  **Test (Integration):** Write tests to verify:
    *   The component renders all its child controls.
    *   Interacting with the controls (toggling the switch, clicking the button) correctly updates the global Zustand store.

---

### Tasks / Subtasks (Idempotent)

- [x] **(AC: 1)** Create the `controls-bar.tsx` file.
- [x] **(AC: 2, 3, 4)** Assemble the UI using Shadcn's `Switch`, `Label`, `Button`, and `Input` components.
- [x] **State:** Create a new Zustand store `use-filter.store.ts` to manage the state of the controls.
- [x] **(AC: 2)** Connect the `Switch` component to the Zustand store.
- [x] **(AC: 3)** Connect the `Button` to the Zustand store.
- [x] **(AC: 4)** Add the `Search` icon to the `Input` component.
- [x] **Test (Integration):** Write and pass all tests to verify the component's rendering and state integration.
- [x] **Finalize:** Mark the story as complete.

### Dev Agent Record

**Completion Notes:**

*   **Implementation:** Created the `ControlsBar` component in `apps/client/src/components/shared/controls-bar.tsx`.
*   **State Management:** Implemented a new Zustand store, `useFilterStore`, located at `apps/client/src/store/use-filter.store.ts`. This store manages the `vegOnly` (boolean) and `sortBy` ('asc' | 'desc') states globally.
*   **Component Integration:** The `ControlsBar` component is fully integrated with the `useFilterStore`. The "Veg Only" `Switch` and the "Sort by Price" `Button` read from and write to the global store, ensuring that filter and sort states are available to the entire application.
*   **UI:** The component's UI is built using `shadcn-ui` components (`Switch`, `Button`, `Input`, `Label`) and styled with Tailwind CSS. The sort button's text dynamically updates to reflect the current sort order (e.g., "Price: Low to High").
*   **Testing:** Developed a test suite in `src/__tests__/components/shared/controls-bar.test.tsx` that verifies the component renders correctly and that user interactions properly update the Zustand store. All tests are passing.

**File List:**

*   `apps/client/src/store/use-filter.store.ts` (created)
*   `apps/client/src/components/shared/controls-bar.tsx` (created)
*   `docs/qa/assessments/1.5-test-controls-bar.md` (created)
*   `apps/client/src/__tests__/components/shared/controls-bar.test.tsx` (created)
*   `docs/stories/1.5.story.md` (modified)

**Change Log:**

*   feat(1.5): create controls bar and filter store
*   test(1.5): add tests for controls bar component
