<!-- Powered by BMADâ„¢ Core -->

# Story 2.4: Create Protected Dashboard Route & Logout

**Status:** Approved

**Story Statement:** As a vendor, I want the management dashboard to be private, so that my business data is secure.

**Acceptance Criteria:**
1.  A new route is created at `/vendor/dashboard`.
2.  Unauthenticated users are redirected to `/login`.
3.  A "Logout" button is available and functional.

---

## Dev Notes

### Frontend Architecture/Routing
*   The `/vendor/dashboard` route will be a protected route. This means it will check for an active user session.
*   If no session exists, the user will be redirected to the `/login` page.
*   This protection can be implemented using a higher-order component (HOC) or a layout component that wraps the dashboard pages.
    [Source: architecture/10-frontend-architecture.md#Routing]
*   The component organization suggests `/src/app/(dashboard)/vendor/dashboard/page.tsx` for the dashboard page and `/src/app/(dashboard)/layout.tsx` for the layout component that can handle the protection.
    [Source: architecture/10-frontend-architecture.md#Component Organization]

### Authentication
*   Authentication is handled by Supabase Auth, which provides session management.
    [Source: architecture/3-tech-stack.md#Authentication, architecture/15-security-and-performance.md#Authentication]
*   The logout functionality will utilize Supabase Auth's `signOut` method.
    [Source: architecture/6-components.md#AuthManager]

### Component Specifications
*   The `AuthManager` component is responsible for handling the authentication flow, including logout functionality.
    [Source: architecture/6-components.md#AuthManager]
*   The `VendorDashboard` component acts as the main layout and container for the authenticated vendor experience.
    [Source: architecture/6-components.md#VendorDashboard]

### File Locations
*   The dashboard route will be created at `/src/app/(dashboard)/vendor/dashboard/page.tsx`.
*   The layout component for protection can be at `/src/app/(dashboard)/layout.tsx`.
*   Logout functionality can be integrated into a UI component within the dashboard or a shared navigation component.

### Testing Requirements
*   **Unit Tests:**
    *   Test the redirection logic of the protected route/layout component.
    *   Test the `signOut` function of the authentication service.
    [Source: architecture/16-testing-strategy.md#Unit Tests]
*   **Integration Tests:**
    *   Test that an unauthenticated user attempting to access `/vendor/dashboard` is redirected to `/login`.
    *   Test that a logged-in user can successfully log out and is redirected to a public page (e.g., `/login`).
    [Source: architecture/16-testing-strategy.md#Integration Tests]
*   **End-to-End (E2E) Tests:**
    *   Verify the complete flow: user logs in, accesses dashboard, logs out, and is redirected correctly.
    [Source: architecture/16-testing-strategy.md#End-to-End (E2E) Tests]

### Technical Constraints
*   Next.js App Router for routing and layout management.
*   Supabase client library for authentication interactions.
    [Source: architecture/3-tech-stack.md#Frontend Framework, architecture/3-tech-stack.md#Authentication]

### Security Considerations
*   The protected route ensures that only authenticated users can access sensitive dashboard data.
    [Source: architecture/15-security-and-performance.md#Authorization]

---

## Tasks / Subtasks

1.  **Create Protected Dashboard Route (AC: 1, 2)**
    *   Create the directory structure and `page.tsx` for `/src/app/(dashboard)/vendor/dashboard/`.
    *   Implement a layout component (e.g., `/src/app/(dashboard)/layout.tsx`) that checks for user authentication status.
    *   If the user is unauthenticated, redirect them to `/login`.
    *   Write unit tests for the authentication check and redirection logic in the layout component.
    *   Write integration tests to verify route protection.
    [Source: architecture/10-frontend-architecture.md#Routing, architecture/16-testing-strategy.md#Integration Tests]

2.  **Implement Logout Functionality (AC: 3)**
    *   Add a "Logout" button to the dashboard UI (e.g., in a navigation bar or header).
    *   Implement the `onClick` handler for the logout button to call Supabase Auth's `signOut` method.
    *   After successful logout, redirect the user to a public route (e.g., `/login`).
    *   Write unit tests for the logout function.
    *   Write E2E tests to verify the complete logout flow.
    [Source: architecture/6-components.md#AuthManager, architecture/16-testing-strategy.md#End-to-End (E2E) Tests]
