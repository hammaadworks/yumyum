# Story 2.3: Implement Magic Link Authentication

## Status

Done

## Story

**As a** vendor,
**I want** to securely log in using only my email,
**so that** I don't have to remember a password.

## Acceptance Criteria

1. A `/login` page is created with a form to enter an email address.
2. Submitting a valid email address triggers the Supabase magic link authentication function.
3. After submitting, the UI informs the user to check their email for a login link.
4. Clicking the magic link from the email successfully authenticates the user and redirects them to the `/vendor/dashboard`.

## Tasks / Subtasks

- [x] **Task 1 (AC: 1):** Create the login page UI.
  - [x] **Subtask 1.1:** Create a new route at `/login`.
  - [x] **Subtask 1.2:** Build a simple form with an email input field and a "Send Magic Link" button.
- [x] **Task 2 (AC: 2, 3):** Implement the magic link logic.
  - [x] **Subtask 2.1:** Create a service function that calls the Supabase `signInWithOtp` method with the user's email.
  - [x] **Subtask 2.2:** On successful submission, display a message on the UI instructing the user to check their email.
- [x] **Task 3 (AC: 4):** Handle the authentication callback.
  - [x] **Subtask 3.1:** The application needs to handle the user returning from the email link. Supabase's client library handles the session creation automatically. Ensure the user is redirected to `/vendor/dashboard` after authentication.

## Dev Notes

### Dev Agent Record

- **File List**:
  - `src/app/(auth)/login/page.tsx` (created)
  - `src/lib/supabase/client.ts` (created)
  - `src/lib/supabase/server.ts` (created)
  - `src/app/auth/callback/route.ts` (created)

### Dev Notes

#### Backend Architecture & Authentication

- This story is a direct implementation of the authentication strategy defined in the architecture. We will use Supabase's built-in Magic Link (passwordless) feature.
- The core interaction will be with the `@supabase/supabase-js` client library, specifically the `signInWithOtp` method.
  - **[Source: `docs/architecture/11-backend-architecture.md`]**

#### Frontend Architecture

- The login page should be created within the `src/app/(auth)/login/` directory as per our defined project structure.
- A new service file, `src/services/auth.ts`, should be created to abstract the interaction with the Supabase client, in accordance with our coding standards.
  - **[Source: `docs/architecture/10-frontend-architecture.md`]**

### Testing

- **Unit Tests:**
  - Write a unit test for the `login` page to ensure the form renders correctly.
  - Write a unit test for the `auth.ts` service to ensure it calls the Supabase client with the correct parameters. Mock the Supabase client for this test.
- **E2E Test:**
  - Create an end-to-end test that simulates a user entering their email, and mock the Supabase client to verify that the magic link flow is initiated correctly. This is a critical user journey and must be tested.
  - **[Source: `docs/architecture/16-testing-strategy.md`]**

## Change Log

| Date       | Version | Description            | Author             |
| :--------- | :------ | :--------------------- | :----------------- |
| 2025-10-22 | 1.0     | Initial draft created. | Bob (Scrum Master) |
