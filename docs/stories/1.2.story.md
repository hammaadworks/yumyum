# Story 1.2: Implement 'Chat on WhatsApp' FAB

## Status
Done

## Story
**As a** vendor interested in the premium plan,
**I want** to instantly start a WhatsApp chat with a pre-filled message,
**so that** I can quickly inquire about the service.

## Acceptance Criteria
1. The "Interested?" FAB (Floating Action Button) is present on the landing page.
2. Clicking the FAB opens a WhatsApp chat (`wa.me` link).
3. The WhatsApp chat is pre-populated with a standard message.
4. The target phone number and the pre-populated message are defined in a constants file.

## Tasks / Subtasks
- [x] **Task 1 (AC: 4):** Create a new constants file at `src/lib/constants.ts`.
  - [x] **Subtask 1.1:** Add a `WHATSAPP_NUMBER` constant.
  - [x] **Subtask 1.2:** Add a `WHATSAPP_INTEREST_MESSAGE` constant.
- [x] **Task 2 (AC: 1, 2, 3):** Modify the `src/components/features/landing/InterestCTA.tsx` component.
  - [x] **Subtask 2.1:** Ensure the component is rendered as a Floating Action Button (FAB) and includes a WhatsApp logo icon from the Lucide Icons library.
  - [x] **Subtask 2.2:** Update the `onClick` handler to construct a `wa.me` URL using the constants from `src/lib/constants.ts`. The URL should be in the format `https://wa.me/{WHATSAPP_NUMBER}?text={encoded_message}`.
  - [x] **Subtask 2.3:** On click, open the constructed URL in a new tab.
- [x] **Task 3 (AC: N/A):** Update Google Analytics Tracking.
  - [x] **Subtask 3.1:** The existing `premium_cta_clicked` event fired from the `InterestCTA` component in Story 1.1 is sufficient and accurately describes the user action. No new event is needed.
- [x] **Task 4 (AC: N/A):** Update unit tests for the `InterestCTA` component.
  - [x] **Subtask 4.1:** Modify the existing test file to assert that the `onClick` handler attempts to open the correctly formatted `wa.me` URL.

## Dev Agent Record

### File List
- `src/lib/constants.ts` (created)
- `src/components/features/landing/InterestCTA.tsx` (modified)
- `src/components/features/landing/__tests__/InterestCTA.test.tsx` (modified)

## Dev Notes

### Previous Story Insights
- **Analytics:** The `premium_cta_clicked` GA event implemented in Story 1.1 remains relevant and accurately captures the user's intent. No further analytics changes are required for this story.

### Constants
- A new file for application-wide constants should be created at `src/lib/constants.ts`. This file will store the WhatsApp number and the pre-populated message to ensure they are easily configurable.
- **[Source: `docs/architecture/17-coding-standards.md` - General good practice]**

### Component & File Structure
- **No New Components:** This story does not require any new components.
- **Modified Component:** The existing `src/components/features/landing/InterestCTA.tsx` will be refactored to handle the direct WhatsApp link generation.
- **No Drawer:** The `InterestDrawer.tsx` component is no longer needed and should not be created.
- **[Source: `docs/architecture/10-frontend-architecture.md`]**

### State Management
- **No Global State:** With the removal of the drawer, there is no longer a need for global UI state management (via Zustand) for this feature. The component can be a simple link or button.
- **[Source: `docs/architecture/10-frontend-architecture.md`]**

### External Services
- **WhatsApp:** The feature will integrate directly with WhatsApp using a `wa.me` link. The phone number and message text must be stored in the new constants file, not as environment variables, for simplicity.

### Testing
- **Location:** Tests for the `InterestCTA` component should already exist at `src/components/features/landing/__tests__/InterestCTA.test.tsx`. These tests need to be updated.
- **Tools:** Use Jest and React Testing Library.
- **Scope:** Tests should verify that the component renders correctly and that clicking it triggers the opening of the correct `wa.me` link with the properly encoded message.
- **[Source: `docs/architecture/16-testing-strategy.md`]**

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-22 | 1.0 | Initial draft created. | Bob (Scrum Master) |
| 2025-10-22 | 1.1 | Reworked story to remove drawer and use a direct WhatsApp FAB. | Bob (Scrum Master) |
| 2025-10-22 | 1.2 | Implemented FAB, constants, and tests. | James (Developer) |

## QA Results

### Review Date: 2025-10-22

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
The overall code quality is good. The implementation uses a sensible fallback pattern for the WhatsApp link and correctly separates constants.

### Refactoring Performed
None. The code is clear and functional.

### Compliance Check
- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Improvements Checklist
- [x] **Improve Test Coverage:** The unit test in `InterestCTA.test.tsx` only validates the `https://wa.me/` fallback link via `window.open`. It does not currently test the primary `whatsapp://send` deep link attempt that uses `window.location.href`. Please update the test to cover this case.

### Security Review
No security concerns identified.

### Performance Considerations
No performance concerns identified.

### Files Modified During Review
None.

### Gate Status
Gate: CONCERNS → docs/qa/gates/1.2-implement-chat-on-whatsapp-fab.yml

### Recommended Status
✗ Changes Required - See unchecked items above

---

### Review Date: 2025-10-22

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
The developer has successfully updated the unit test to cover both the primary deep link (`whatsapp://`) and the fallback (`https://wa.me/`) scenarios. The test now provides comprehensive coverage for the component's behavior.

### Refactoring Performed
None required.

### Compliance Check
- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Improvements Checklist
All previous concerns have been addressed.

### Security Review
No security concerns identified.

### Performance Considerations
No performance concerns identified.

### Files Modified During Review
None.

### Gate Status
Gate: PASS → docs/qa/gates/1.2-implement-chat-on-whatsapp-fab.yml

### Recommended Status
✓ Ready for Done
