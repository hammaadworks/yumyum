---
epic: 4
story: 1
title: "Public Media Uploader (Multi-Account)"
status: "Draft"
---

### Story Statement

As a vendor, I need a simple page where I can upload my dish photos and videos, so I can get the public URLs to add to my Google Sheet menu.

### Acceptance Criteria

1.  A page exists at `/vendor/upload` that is publicly accessible.
2.  Before uploading, the system reads the `Admin_Config` to find the vendor's assigned `cloudinary_account_id`.
3.  The system uses the corresponding environment variables (e.g., `CLOUDINARY_[ID]_KEY`) to authenticate with the correct Cloudinary account.
4.  On upload, the file is sent to the assigned Cloudinary account. If the upload fails, an alert is sent via the Lark webhook.
5.  The public URL is then displayed on-screen with a "Copy URL" button.

### Dev Notes

#### Technical Specifications

*   **Architecture:** This requires a client-server setup. The public page at `/vendor/upload` will be the client, and a new Next.js API Route (e.g., `app/api/upload/route.ts`) will act as the server to handle the secure upload process.
*   **Security:** The Cloudinary API keys **must not** be exposed on the client-side. The API route will read the keys from environment variables on the server.
*   **Cloudinary SDK:** Use the official `cloudinary` Node.js SDK in the API route to perform the upload.
*   **Multi-Account Logic:** The API route will need to receive a vendor identifier from the client, look up the `cloudinary_account_id` in the `Admin_Config` sheet, and then select the correct API credentials to instantiate the Cloudinary SDK.

#### File Locations

*   **Page:** `apps/client/src/app/vendor/upload/page.tsx`
*   **API Route:** `apps/client/src/app/api/upload/route.ts` (inferred)

### Tasks / Subtasks

1.  **(AC: 1)** Create the `page.tsx` for the `/vendor/upload` route.
2.  **UI:** Build a simple UI with a file input and an upload button.
3.  **(AC: 1)** Create the `route.ts` for the `/api/upload` API endpoint.
4.  **(AC: 2, 3)** In the API route, implement the logic to:
    a.  Receive the file and vendor ID from the client request.
    b.  Fetch and parse the `Admin_Config` Google Sheet to find the `cloudinary_account_id` for the vendor.
    c.  Select the correct Cloudinary API key and secret from the server's environment variables.
    d.  Instantiate the Cloudinary SDK with these credentials.
5.  **(AC: 4)** Use the SDK to upload the file to Cloudinary. Implement error handling and send a Lark alert on failure.
6.  **(AC: 5)** The API route should return the secure URL of the uploaded file in its response.
7.  **(AC: 5)** The client-side page should then display this URL to the user with a "Copy URL" button.
8.  **Test (API):** Write API tests for the `/api/upload` endpoint to verify the multi-account logic and error handling.
9.  **Test (Integration):** Write tests for the upload page to verify that a file can be selected and the result from the API is displayed correctly.
