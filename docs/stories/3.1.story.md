---
epic: 3
story: 1
title: "Frictionless Feedback Funnel"
status: "Draft"
---

### Story Statement

As a vendor, I want to automatically encourage happy customers to leave public reviews while capturing negative feedback privately, so I can improve my online reputation and my service.

### Acceptance Criteria

1.  The checkout page (from Story 2.9) contains the entry point for leaving a rating.
2.  Tapping the rating entry point displays a view with a 5-star input, enhanced with high-quality micro-animations.
3.  If the user selects a rating of **4 or 5 stars**, a "Thank You" message is briefly displayed, and they are **immediately** redirected to the vendor's `review_link` (Google Review page).
4.  If the user selects a rating of **1, 2, or 3 stars**, the application **immediately** opens WhatsApp with a pre-filled message to the vendor's number, ready for private feedback.
5.  If the user submits a 1-star rating, an alert is sent via the Lark webhook.
6.  The entire flow from tapping a star to redirection must be seamless and feel instantaneous, with zero friction.

### Dev Notes

#### Technical Specifications

*   **Component:** A new `FeedbackView` or modal component will be created to house the 5-star rating input.
*   **UI/UX:** The star rating component should be highly interactive, with animations on hover and selection to encourage user engagement.
*   **Routing Logic:** The core of this story is the conditional routing based on the user's input. This logic will be triggered by the `onClick` handler of the stars.
*   **Data:** The component needs access to the `brand` data object to get the `review_link` and `whatsapp` number.
*   **Alerting:** The Lark webhook integration (from Story 1.2) will be used to send an alert for 1-star ratings.

#### File Locations

*   This story will modify:
    *   `apps/client/src/components/features/cart/CartSummary.tsx`
*   This story will create a new component, e.g.:
    *   `apps/client/src/components/features/feedback/FeedbackView.tsx`

### Tasks / Subtasks

1.  **(AC: 1)** In `CartSummary.tsx`, update the `onClick` handler for the "Leave a rating" button to open the new `FeedbackView`.
2.  **(AC: 2)** Create the `FeedbackView.tsx` component. Implement a 5-star rating input. Use a library like `framer-motion` for the micro-animations.
3.  **(AC: 3)** Implement the `onClick` handler for the stars. If the rating is >= 4, show a quick toast/message and then programmatically redirect the user to the `brand.review_link`.
4.  **(AC: 4)** If the rating is < 4, the handler should immediately open a pre-formatted WhatsApp link to the `brand.whatsapp` number.
5.  **(AC: 5)** If the rating is 1, call the Lark webhook service to send a critical alert before opening WhatsApp.
6.  **(AC: 6)** Ensure the transitions are fast and smooth to minimize friction.
7.  **Test (Integration):** Write tests to verify:
    *   Clicking the rating button opens the feedback view.
    *   A high rating redirects to the correct `review_link`.
    *   A low rating attempts to open the correct WhatsApp link.
