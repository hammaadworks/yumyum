---
epic: 2
story: 5
title: "Core Ordering Interaction (v2 - Simplified)"
status: "Draft"
---

### Story Statement

As a user, I want to be able to easily add items to my cart from the Reel View, so I can build my order while I browse.

### Acceptance Criteria

1.  Double-tapping the center media display adds the current dish to the cart. This does not remove items.
2.  A confirmation micro-animation (e.g., a plus icon) appears over the media on successful addition.
3.  A dedicated "Add to Cart" button is present in the `ReelActionBar`. It acts as a toggle: tapping it adds the item, and tapping it again removes it. The button's visual state updates with micro-animations.
4.  The number badge on the `GlobalCart` component updates in real-time as items are added or removed.

### Dev Notes

#### Technical Specifications

*   **State Management:** All interactions in this story will call action methods on the global `useCartStore` (e.g., `addItem`, `removeItem`). [Source: `docs/ui-architecture.md#Section-5`]
*   **Interaction:**
    *   The double-tap functionality will be added to the `MediaDisplay` component (from Story 2.2).
    *   The "Add to Cart" button will be added to the `ReelActionBar` component (from Story 2.4).
*   **UI Feedback:** The `GlobalCart` component (Story 1.7) must be subscribed to the cart store to show the live item count. A simple animation (e.g., using `framer-motion`) should be triggered for the confirmation effect.

#### File Locations

*   This story will modify:
    *   `apps/client/src/components/features/reel/MediaDisplay.tsx`
    *   `apps/client/src/components/features/reel/ReelActionBar.tsx`
    *   `apps/client/src/store/use-cart.store.ts`

### Tasks / Subtasks

1.  **(AC: 1)** In `MediaDisplay.tsx`, add an `onDoubleClick` event handler that calls the `addItem` action on the `useCartStore`.
2.  **(AC: 2)** Implement a simple, short-lived animation (e.g., a fading/scaling plus icon) that appears over the media when the double-tap event is fired.
3.  **(AC: 3)** In `ReelActionBar.tsx`, add a new "Add to Cart" button. This button's state (e.g., added or not) should be derived by checking if the current dish exists in the cart store.
4.  **(AC: 3)** The `onClick` handler for this button should check if the item is in the cart. If not, it calls `addItem`. If it is, it calls `removeItem`.
5.  **(AC: 4)** Verify that the `GlobalCart` component, which is already subscribed to the cart store, updates its badge count correctly when these actions are performed.
6.  **Test (Integration):** Write tests to verify:
    *   Double-tapping `MediaDisplay` calls `cartStore.addItem`.
    *   Clicking the "Add to Cart" button correctly calls either `addItem` or `removeItem`.
    *   The `GlobalCart` badge count reflects the changes in the cart store.

---

### Tasks / Subtasks (Idempotent)

- [x] **(AC: 1)** In `MediaDisplay.tsx`, add an `onDoubleClick` event handler to add items to the cart.
- [x] **(AC: 2)** Implement a confirmation animation on double-tap.
- [x] **(AC: 3)** In `ReelActionBar.tsx`, add a new "Add to Cart" toggle button.
- [x] **(AC: 3)** The button's `onClick` handler correctly adds or removes the item from the cart.
- [x] **(AC: 4)** Verify that the `GlobalCart` badge updates as expected (covered by existing tests).
- [x] **Test (Integration):** Write and pass all tests to verify the new ordering interactions.
- [x] **Finalize:** Mark the story as complete.

### Dev Agent Record

**Completion Notes:**

*   **Implementation:**
    *   Modified `MediaDisplay.tsx` to include an `onDoubleClick` handler that calls `useCartStore.addItem(dish)`. A simple plus icon animation was added using `framer-motion` to provide visual feedback.
    *   Modified `ReelActionBar.tsx` to include a new "Add to Cart" button. This button is a toggle that adds or removes the current dish from the cart.
*   **Functionality:**
    *   The `ReelActionBar` button's state is reactive, showing a "plus" icon when the item is not in the cart and a "check" icon when it is.
    *   All cart interactions correctly update the global `useCartStore`.
*   **Testing:** Developed a test suite in `src/__tests__/components/features/reel/ordering-interactions.test.tsx` that validates both the double-tap and button-click functionalities. All tests are passing.

**File List:**

*   `apps/client/src/components/features/reel/media-display.tsx` (modified)
*   `apps/client/src/components/features/reel/reel-action-bar.tsx` (modified)
*   `docs/qa/assessments/2.5-test-ordering-interaction.md` (created)
*   `apps/client/src/__tests__/components/features/reel/ordering-interactions.test.tsx` (created)
*   `docs/stories/2.5.story.md` (modified)

**Change Log:**

*   feat(2.5): implement core ordering interactions in reel view
*   test(2.5): add tests for ordering interactions
