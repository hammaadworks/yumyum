# Test Design: Story 2.1

Date: 2025-10-22
Designer: Quinn (Test Architect)

## Test Strategy Overview

This story is foundational and involves manual infrastructure setup and documentation. Therefore, the testing strategy relies heavily on **manual verification** and **peer reviews** rather than automated unit or E2E tests. The goal is to ensure the foundational setup is correct, secure, and well-documented.

- Total test scenarios: 4
- Manual Verification tests: 3
- Integration tests (scripted): 1
- Priority distribution: P0: 3, P1: 1

## Test Scenarios by Acceptance Criteria

### AC1: A primary Supabase project and a pool of subsidiary vendor accounts are created.

| ID          | Level  | Priority | Test                                                                                                                                                        | Justification                                                                                                         |
| :---------- | :----- | :------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- |
| 2.1-MAN-001 | Manual | P0       | **Verify Supabase Projects**: Confirm that one primary and four subsidiary projects have been created in the Supabase dashboard and that access is granted. | This is a manual provisioning step. The only way to verify is to visually inspect the result in the Supabase console. |

### AC2: API keys are added to environment variables.

| ID          | Level       | Priority | Test                                                                                                                                                                                                                                                 | Justification                                                                                                                                                                                                       |
| :---------- | :---------- | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 2.1-INT-001 | Integration | P0       | **Test Environment Variables**: Create and run a temporary script that loads `.env.local`, initializes the Supabase client, and performs a simple query (e.g., fetch a list of tables) against the primary project to confirm successful connection. | This verifies that the keys are correct and the project is accessible from the development environment. It's an integration test because it crosses the boundary from the local environment to an external service. |

### AC3: A `vendor_mappings` table is created in the primary project.

| ID          | Level  | Priority | Test                                                                                                                                                                                                                                                                                                                  | Justification                                                                                                                                    |
| :---------- | :----- | :------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- |
| 2.1-MAN-002 | Manual | P0       | **Verify Database Migration**: After applying the migration, connect to the primary project's database (e.g., via Supabase SQL Editor) and run a query to describe the `vendor_mappings` table. Verify that all columns, types, and constraints match the schema defined in `docs/architecture/9-database-schema.md`. | This is the most reliable way to confirm a database migration has been applied correctly. It directly inspects the state of the database schema. |

### AC4: The manual vendor allocation process is documented in the wiki.

| ID          | Level  | Priority | Test                                                                                                                                                                            | Justification                                                                                                                            |
| :---------- | :----- | :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------- |
| 2.1-MAN-003 | Manual | P1       | **Peer Review Documentation**: Have another developer read the `vendor-allocation-process.md` wiki page and confirm they can understand and follow the steps without ambiguity. | Documentation for a manual process is only as good as its clarity. A peer review is the best way to test for ambiguity and completeness. |

## Risk Coverage

| Risk ID | Mitigated By | Notes                                                                                       |
| :------ | :----------- | :------------------------------------------------------------------------------------------ |
| OPS-001 | 2.1-MAN-001  | Manual verification of project setup reduces the risk of configuration errors.              |
| SEC-001 | 2.1-MAN-002  | Verification of the migration ensures RLS is enabled on the table.                          |
| SEC-002 | 2.1-INT-001  | The connection test confirms the keys work, and standard gitignore practices prevent leaks. |
| OPS-002 | 2.1-MAN-003  | Peer review of the documentation ensures the manual process is clear and less error-prone.  |

## Recommended Execution Order

1.  **P0 Manual Verification (2.1-MAN-001)**: After project provisioning.
2.  **P0 Integration Test (2.1-INT-001)**: After adding keys to `.env.local`.
3.  **P0 Manual Verification (2.1-MAN-002)**: After running the database migration.
4.  **P1 Manual Verification (2.1-MAN-003)**: After the wiki page is written.
